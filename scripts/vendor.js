"use strict";var D2R=Math.PI/180,R2D=180/Math.PI,Coord=function(t,r){this.lon=t,this.lat=r,this.x=D2R*t,this.y=D2R*r};Coord.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Coord.prototype.antipode=function(){var t=-1*this.lat,r=this.lon<0?180+this.lon:-1*(180-this.lon);return new Coord(r,t)};var LineString=function(){this.coords=[],this.length=0};LineString.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Arc=function(t){this.properties=t||{},this.geometries=[]};Arc.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1==this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],r=0;r<this.geometries.length;r++)t.push(this.geometries[r].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},Arc.prototype.wkt=function(){for(var t="",r="LINESTRING(",e=function(t){r+=t[0]+" "+t[1]+","},s=0;s<this.geometries.length;s++){if(0===this.geometries[s].coords.length)return"LINESTRING(empty)";var i=this.geometries[s].coords;i.forEach(e),t+=r.substring(0,r.length-1)+")"}return t};var GreatCircle=function(t,r,e){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!r||void 0===r.x||void 0===r.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Coord(t.x,t.y),this.end=new Coord(r.x,r.y),this.properties=e||{};var s=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(s/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g==Math.PI)throw new Error("it appears "+t.view()+" and "+r.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+r)};if(GreatCircle.prototype.interpolate=function(t){var r=Math.sin((1-t)*this.g)/Math.sin(this.g),e=Math.sin(t*this.g)/Math.sin(this.g),s=r*Math.cos(this.start.y)*Math.cos(this.start.x)+e*Math.cos(this.end.y)*Math.cos(this.end.x),i=r*Math.cos(this.start.y)*Math.sin(this.start.x)+e*Math.cos(this.end.y)*Math.sin(this.end.x),o=r*Math.sin(this.start.y)+e*Math.sin(this.end.y),a=R2D*Math.atan2(o,Math.sqrt(Math.pow(s,2)+Math.pow(i,2))),h=R2D*Math.atan2(i,s);return[h,a]},GreatCircle.prototype.Arc=function(t,r){var e=[];if(!t||2>=t)e.push([this.start.lon,this.start.lat]),e.push([this.end.lon,this.end.lat]);else for(var s=1/(t-1),i=0;t>i;++i){var o=s*i,a=this.interpolate(o);e.push(a)}for(var h=!1,n=0,p=r&&r.offset?r.offset:10,c=180-p,l=-180+p,u=360-p,d=1;d<e.length;++d){var g=e[d-1][0],f=e[d][0],v=Math.abs(f-g);v>u&&(f>c&&l>g||g>c&&l>f)?h=!0:v>n&&(n=v)}var y=[];if(h&&p>n){var M=[];y.push(M);for(var w=0;w<e.length;++w){var m=parseFloat(e[w][0]);if(w>0&&Math.abs(m-e[w-1][0])>u){var C=parseFloat(e[w-1][0]),x=parseFloat(e[w-1][1]),G=parseFloat(e[w][0]),S=parseFloat(e[w][1]);if(C>-180&&l>C&&180==G&&w+1<e.length&&e[w-1][0]>-180&&e[w-1][0]<l){M.push([-180,e[w][1]]),w++,M.push([e[w][0],e[w][1]]);continue}if(C>c&&180>C&&-180==G&&w+1<e.length&&e[w-1][0]>c&&e[w-1][0]<180){M.push([180,e[w][1]]),w++,M.push([e[w][0],e[w][1]]);continue}if(l>C&&G>c){var A=C;C=G,G=A;var F=x;x=S,S=F}if(C>c&&l>G&&(G+=360),180>=C&&G>=180&&G>C){var L=(180-C)/(G-C),R=L*S+(1-L)*x;M.push([e[w-1][0]>c?180:-180,R]),M=[],M.push([e[w-1][0]>c?-180:180,R]),y.push(M)}else M=[],y.push(M);M.push([m,e[w][1]])}else M.push([e[w][0],e[w][1]])}}else{var b=[];y.push(b);for(var E=0;E<e.length;++E)b.push([e[E][0],e[E][1]])}for(var I=new Arc(this.properties),D=0;D<y.length;++D){var N=new LineString;I.geometries.push(N);for(var j=y[D],P=0;P<j.length;++P)N.move_to(j[P])}return I},"undefined"==typeof window)module.exports.Coord=Coord,module.exports.Arc=Arc,module.exports.GreatCircle=GreatCircle;else{var arc={};arc.Coord=Coord,arc.Arc=Arc,arc.GreatCircle=GreatCircle}